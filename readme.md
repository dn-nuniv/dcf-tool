# Monte-Carlo DCF Valuation Tool Ver.2.2.1

**企業価値評価（DCF法）を Monte-Carlo シミュレーションで行い、理論株価と「市場が暗黙に織り込む前提」の分布を可視化する Web ツールです。**  

- 割引率（r）や永続成長率（g）に幅を持たせた確率分布を用いることで、  
  「DCFは一点予想で当てられない」という現実的な不確実性を反映した評価ができます。
- さらに **逆DCF（インプライド g / インプライド FCF）** を Monte-Carlo で計算し、  
  「現在の株価からみて、どの程度の成長率・キャッシュフロー水準が市場に織り込まれているか」を  
  モデルベースで考察できるようにしました。
- 学生・教員・研究者など、想定読者ごとに最適な解説を生成する  
  **AIプロンプト自動生成機能（ペルソナ機能）** を備えています。

🔗 デモ（GitHub Pages）  
https://dn-nuniv.github.io/dcf-tool/

---

## 🚀 Features（主な機能）

### 1. Monte Carlo DCF（順DCF）

- 成長率 g と割引率 r を **三角分布（三点指定：min / mode / max）** からサンプリング
- 各試行ごとに理論株価を計算し、**確率分布（ヒストグラム）**として表示
- 統計量の表示
  - モードDCF（g=mode, r=mode）
  - 平均値・中央値
  - 5% 点〜95% 点レンジ
  - 「現在株価を上回る確率」
  - 現在株価・モードDCFが分布の中で占めるパーセンタイル位置

### 2. Reverse DCF（インプライド分析）

- 現在の株価と Net Debt から **Enterprise Value (EV)** を求め、
- 割引率 r の分布と FCF₀ を前提として、
  - **インプライド FCF**  
    EV = FCF / (r − g) から逆算
  - **インプライド g**  
    EV = FCF₀ / (r − g) から g = r − (FCF₀ / EV) として逆算
- これらを Monte Carlo で多数サンプルし、
  - Implied FCF の分布（ヒストグラム）
  - Implied g の分布（ヒストグラム）
  - **FCF × g のジョイントヒートマップ**（どの組み合わせがどれくらい頻出するか）
- 「最も出現頻度の高い組み合わせ（g, FCF）」をテキストでも表示

> ※ この「最も出現頻度の高い組み合わせ」は、  
> **現在の株価と、ここで仮定した割引率の分布などの前提から逆算したときに、  
> モデル上もっとも出やすい g と FCF の組み合わせ** を意味します。  
> 投資家が実際にこう考えていると断定するものではなく、  
> あくまで本ツールの前提条件に依存した代表値として解釈してください。

### 3. Sensitivity Heatmap（感応度ヒートマップ）

- g（縦軸）と r（横軸）のグリッドを取り、
- 各マスごとに理論株価を計算し、**色の濃淡で水準を可視化**
- g と r の組合せが理論株価に与える影響を直感的に把握可能

### 4. Implied Heatmap（インプライド・ヒートマップ）

- 逆DCFで得られた多数の (g, FCF) サンプルから
  - 出現頻度の高いゾーン
  - 典型的な組み合わせ（モード）
- をヒートマップとして可視化  
  → 「このモデルと前提のもとで、市場が典型的に織り込んでいると考えられる  
     g と FCF の代表的な組合せ」を定性的に議論できます。

### 5. Persona-based AI Prompt Generator（ペルソナ別AI解説プロンプト）

DCFや逆DCFは専門性が高く、一般的な説明だけでは十分に伝わらないため、  
**想定読者ごとに最適化された AI 解説プロンプトを自動生成** します。

- ペルソナ選択
  - 学生
  - 教員
  - 研究者
- シミュレーション結果（統計量・レンジ・確率・インプライド分布など）を集約し、
- 選択したペルソナ向けに
  - どんな見出し構成で
  - どのトーンで
  - 何を重点的に説明してほしいか
- を含んだプロンプトを自動生成します。

これにより、利用者が高度な「質問スキル」や「読者設計スキル」を持っていなくても、  
**学生・教員・研究者それぞれに適したレベルの解説を生成AIから引き出すことができます。**

### 6. Data Export / 図表の保存

- 理論株価の分布（サマリー / 生データ）を TSV 形式でダウンロード
- 感応度ヒートマップ・インプライドヒートマップの数値を TSV で保存
- 各種グラフ（ヒストグラム・ヒートマップ）を PNG として保存  
  → 授業スライド・レポート・論文等にそのまま利用可能

### 7. モデル・教育用途の前提

- g ≥ r となる試行は DCF モデルが破綻するため、自動的にスキップまたは警告
- FCF がマイナスの場合には、モデルの限界についても UI 上で警告表示  
- あくまで **教育・探索的分析のためのツール** と位置づけ、  
  投資判断そのものを直接推奨するものではありません。

---

## 📘 Inputs（入力項目）

| 項目 | 内容 |
|---|---|
| 営業CF（過去5年） | 選択単位で入力（簡易モードで FCF₀ を推計） |
| 有形・無形固定資産の取得額（過去5年） | CapEx として使用 |
| 将来FCF（1〜5年） | 将来予測モードで使用（Year1〜Year5） |
| 現金・有利子負債残高 | Net Debt（有利子負債 − 現金等）を算出 |
| 発行済株式数 | 1株あたり理論株価の算出に使用 |
| 現在株価 | Monte Carlo DCF 結果との比較、および逆DCFの EV 算定に使用 |
| 永続成長率 g | min / mode / max（小数で） |
| 割引率 r | min / mode / max または固定値 |
| シミュレーション回数 | Monte Carlo 試行回数（例：10,000 など） |
| 乱数シード | 再現性確保のため任意に指定可能 |
| ペルソナ | 学生 / 教員 / 研究者を選択して AI 解説プロンプトを生成 |

※ g ≥ r の場合は DCF モデルが成立しないため、その組合せは自動的に除外されます。

---

## 🎯 Purpose（開発目的）

- 不確実性を考慮した **より現実的な DCF** を教育現場で活用する
- 「一点予想」ではなく **レンジで判断する思考** を育成する
- **Monte Carlo シミュレーション**と**逆DCF**を通じて、
  - 「現在の株価にはどのような成長率・キャッシュフローの前提が織り込まれているのか」
  - 「その前提は妥当と言えるのか」
  を考える材料を提供する
- データサイエンス（分布・推定・シミュレーション）と  
  ファイナンス教育を接続する教材として活用する
- さらに、ペルソナ別AIプロンプト機能により、
  **質問スキル・読者設計スキルをツール側に埋め込む試み**として位置づけています。

---

## 🛠 Technology（使用技術）

- HTML / CSS / JavaScript（Vanilla）
- Chart.js（ヒストグラム・ヒートマップの描画）
- GitHub Pages（ホスティング）
- 各種 TSV / PNG 出力はブラウザ内 JavaScript のみで完結

---

## 📊 実装モデル概要

### 1. 順DCF（Monte Carlo DCF）

各シミュレーション試行ごとに：

```text
FCF₁ = FCF₀ × (1 + g)
TV   = FCF₁ / (r − g)
Equity Value = TV − Net Debt
Stock Price  = Equity Value / Shares
```

	•	不正試行（r ≤ g）は除外。
	•	試行結果（通常 10,000 回以上）から統計量および分布を生成。

将来予測モードでは、1〜5年の FCF を個別に入力し、

```
Equity Value = Σ FCF_t / (1 + r)^t  +  TV / (1 + r)^5  − Net Debt
```

として算定します。

2. 逆DCF（Implied g / Implied FCF）
	•	EV（Enterprise Value）を
EV = 現在株価 × 株式数 + Net Debt
と定義し、
	•	割引率 r と成長率 g（または FCF₀）との関係を用いて、
	•	Implied FCF : FCF = EV × (r − g)
	•	Implied g   : g = r − (FCF₀ / EV)
	•	を Monte Carlo シミュレーションで多数サンプルします。

得られたサンプルから：
	•	Implied FCF 分布（ヒストグラム）
	•	Implied g 分布（ヒストグラム）
	•	(g, FCF) のジョイント分布（ヒートマップ）
	•	「モデル上、最も頻度の高い組合せ」

を可視化し、
現在の株価が暗黙に要請する前提の「典型例」や「ばらつき」 を確認できます。

なお、これらはあくまで本ツールで置いた前提（特に r の分布と FCF₀ の設定）に依存する
モデル上の結果であり、「投資家が実際にその通りに考えている」と断定するものではありません。

⸻

💡 FCF の定義について（簡易版の注意）

本ツールでは、実務上の複雑さと入力のしやすさを両立させるため、
フリー・キャッシュフロー（FCF）を次のように 簡便的に定義しています。

FCF ≒ 営業CF − 有形・無形固定資産の取得額（CapEx）

具体的には：
	•	キャッシュフロー計算書の
「営業活動によるキャッシュ・フロー」合計（営業CF）
	•	同じく投資CFの内訳に記載される
「有形固定資産の取得による支出」
および 「無形固定資産の取得による支出」（CapEx）

のみを用いて FCF を近似しています。 ￼

なぜ投資CF全体を使わないのか？

投資CFには、設備投資以外にも以下のような項目が含まれることがあります。
	•	有価証券などの余資運用
	•	子会社株式の取得・売却
	•	貸付・回収
	•	その他の一時的な投資取引

これらをすべて「設備投資」とみなして差し引いてしまうと、
企業本来の事業活動が生み出す FCF から大きく乖離する可能性があります。

そこで本ツールでは、
	•	投資CFのうち 「有形・無形固定資産の取得額」に相当する部分のみを CapEx とみなし、
	•	「営業CF − CapEx」で FCF を簡便的に近似する

という折衷案を採用しています。

限界と注意点
	•	金融機関や特殊なビジネスモデルの企業など、
CF計算書の構造自体が一般事業会社と異なるケースでは、本ツールの FCF 定義は適合しない場合があります。
	•	M&A（のれん）や大規模な投資プロジェクトを多用する企業では、
より精緻な調整が必要になることがあります。

本ツールはあくまで 「教育・分析の入口」を提供するための簡易DCFツールであり、
最終的な投資判断や高度なバリュエーションには、個別企業の状況に応じた追加分析が必要です。

⸻

📦 Setup（導入方法）

```
git clone https://github.com/dn-nuniv/dcf-tool.git
cd dcf-tool
open index.html
```

ブラウザのみで実行できます（サーバ不要）。

⸻

📄 License

© Daisuke Nakamura, 2025
教育目的での利用を歓迎します。商用利用は別途ご相談ください。

⸻

👤 Author / Maintainer
	•	Daisuke Nakamura
	•	GitHub: https://github.com/dn-nuniv/

⸻

🔄 Changelog
	•	v2.2.1（2025-12-08）
	•	逆DCF（インプライド g / インプライド FCF）を Monte Carlo 分布として実装
	•	Implied g × Implied FCF のジョイントヒートマップを追加し、「最頻組合せ」の解釈を明示
	•	ペルソナ別 AI プロンプト生成機能（学生 / 教員 / 研究者）を追加
	•	各種分布・ヒートマップの TSV / PNG エクスポートを拡充
	•	モデルの前提と限界に関する説明を README に追記
	•	v1.0.0（2025-12-07）
初期公開：Monte-Carlo DCF（順DCF）、将来予測モード、感応度分析対応
